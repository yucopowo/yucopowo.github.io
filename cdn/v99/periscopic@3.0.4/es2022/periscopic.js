/* esm.sh - esbuild bundle(periscopic@3.0.4) es2022 production */import{walk as b}from"/cdn/v99/estree-walker@3.0.1/es2022/estree-walker.js";import m from"/cdn/v99/is-reference@3.0.0/es2022/is-reference.js";function _(r){let e=new WeakMap,i=new Map,l=new c(null,!1),n=[],a=l;b(r,{enter(t,h){switch(t.type){case"Identifier":m(t,h)&&n.push([a,t]);break;case"ImportDeclaration":t.specifiers.forEach(s=>{a.declarations.set(s.local.name,s)});break;case"FunctionExpression":case"FunctionDeclaration":case"ArrowFunctionExpression":t.type==="FunctionDeclaration"?(t.id&&a.declarations.set(t.id.name,t),e.set(t,a=new c(a,!1))):(e.set(t,a=new c(a,!1)),t.type==="FunctionExpression"&&t.id&&a.declarations.set(t.id.name,t)),t.params.forEach(s=>{o(s).forEach(u=>{a.declarations.set(u,t)})});break;case"ForStatement":case"ForInStatement":case"ForOfStatement":e.set(t,a=new c(a,!0));break;case"BlockStatement":e.set(t,a=new c(a,!0));break;case"ClassDeclaration":case"VariableDeclaration":a.add_declaration(t);break;case"CatchClause":e.set(t,a=new c(a,!0)),t.param&&o(t.param).forEach(s=>{a.declarations.set(s,t.param)});break;}},leave(t){e.has(t)&&(a=a.parent)}});for(let t=n.length-1;t>=0;--t){let[h,s]=n[t];h.references.has(s.name)||p(h,s.name),h.find_owner(s.name)||i.set(s.name,s)}return{map:e,scope:l,globals:i}}function p(r,e){r.references.add(e),r.parent&&p(r.parent,e)}var c=class{constructor(e,i){this.parent=e,this.block=i,this.declarations=new Map,this.initialised_declarations=new Set,this.references=new Set}add_declaration(e){if(e.type==="VariableDeclaration"){if(e.kind==="var"&&this.block&&this.parent)this.parent.add_declaration(e);else{let i=l=>{o(l.id).forEach(n=>{this.declarations.set(n,e),l.init&&this.initialised_declarations.add(n)})};e.declarations.forEach(i)}}else e.id&&this.declarations.set(e.id.name,e)}find_owner(e){return this.declarations.has(e)?this:this.parent&&this.parent.find_owner(e)}has(e){return this.declarations.has(e)||!!this.parent&&this.parent.has(e)}};function o(r){return f(r).map(e=>e.name)}function f(r,e=[]){switch(r.type){case"Identifier":e.push(r);break;case"MemberExpression":let i=r;for(;i.type==="MemberExpression";)i=i.object;e.push(i);break;case"ObjectPattern":let l=a=>{a.type==="RestElement"?f(a.argument,e):f(a.value,e)};r.properties.forEach(l);break;case"ArrayPattern":let n=a=>{a&&f(a,e)};r.elements.forEach(n);break;case"RestElement":f(r.argument,e);break;case"AssignmentPattern":f(r.left,e);break;}return e}export{c as Scope,_ as analyze,f as extract_identifiers,o as extract_names};